---
title: "simulations"
output: pdf_document
date: "2025-03-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(2025)
n=200
#library("WinRatio")
library(dplyr)
library(purrr)
```

# Générer les données 

## Générer les fonctions

```{r}
gener_tte=function(mu, lambda=1){
  X=rexp(n, rate=lambda)
  C=rexp(n, rate = mu)
  TT=pmin(X,C)
  delta=as.numeric(X==TT)
  return(list(TT, delta))
}

gener_continue=function(mean){
  X=abs(rnorm(n, mean=mean, sd=1))
  return(X)
}

gener_binom=function(prob){
  X=rbinom(n, size = 1, prob = prob)
  return(X)
}
```


## Différents scénario
Je prend comme généralité que :
 - pour les binomiales, 1 corresponds à l'évènement d'intérêt et qu'il est meilleur d'avoir 0 que 1
 - pour les tte, plus un évènement est censuré moins il est bon (à voir encore)
 - pour les continues, il n'y a que des valeurs positives et une valeur plus grande est préférable

### Scénario 1 : T uniformément meilleur que C

```{r}
# tte/tte
T_1_1=cbind(gener_tte(1.5),gener_tte(1.5))
C_1_1=cbind(gener_tte(0.5),gener_tte(0.5))

# tte/continue
T_1_2=cbind(gener_tte(1.5),gener_continue(2))
C_1_2=cbind(gener_tte(0.5),gener_continue(0))

# tte/binaire
T_1_3=cbind(gener_tte(1.5),gener_binom(0.45))
C_1_3=cbind(gener_tte(0.5),gener_binom(0.75))

# continue/continue
T_1_4=cbind(gener_continue(2),gener_continue(2))
C_1_4=cbind(gener_continue(0),gener_continue(0))

# continue/binaire
T_1_5=cbind(gener_continue(2),gener_binom(0.45))
C_1_5=cbind(gener_continue(0),gener_binom(0.75))

# binaire/binaire
T_1_6=cbind(gener_binom(0.45), gener_binom(0.45))
C_1_6=cbind(gener_binom(0.75), gener_binom(0.75))
```

### Scénario 2 : C uniformément meilleur que T

```{r}
# tte/tte
T_2_1=cbind(gener_tte(0.5),gener_tte(0.5))
C_2_1=cbind(gener_tte(1.5),gener_tte(1.5))

# tte/continue
T_2_2=cbind(gener_tte(0.5),gener_continue(0))
C_2_2=cbind(gener_tte(1.5),gener_continue(2))

# tte/binaire
T_2_3=cbind(gener_tte(0.5),gener_binom(0.75))
C_2_3=cbind(gener_tte(1.5),gener_binom(0.45))

# continue/continue
T_2_4=cbind(gener_continue(0),gener_continue(0))
C_2_4=cbind(gener_continue(2),gener_continue(2))

# continue/binaire
T_2_5=cbind(gener_continue(0),gener_binom(0.75))
C_2_5=cbind(gener_continue(2),gener_binom(0.45))

# binaire/binaire
T_2_6=cbind(gener_binom(0.75), gener_binom(0.75))
C_2_6=cbind(gener_binom(0.45), gener_binom(0.45))
```


### Scénario 3 : T similaire à C

```{r}
# tte/tte
T_3_1=cbind(gener_tte(0.5),gener_tte(0.5))
C_3_1=cbind(gener_tte(0.5),gener_tte(0.5))

# tte/continue
T_3_2=cbind(gener_tte(0.5),gener_continue(2))
C_3_2=cbind(gener_tte(0.5),gener_continue(2))

# tte/binaire
T_3_3=cbind(gener_tte(0.5),gener_binom(0.45))
C_3_3=cbind(gener_tte(0.5),gener_binom(0.45))

# continue/continue
T_3_4=cbind(gener_continue(2),gener_continue(2))
C_3_4=cbind(gener_continue(2),gener_continue(2))

# continue/binaire
T_3_5=cbind(gener_continue(2),gener_binom(0.45))
C_3_5=cbind(gener_continue(2),gener_binom(0.45))

# binaire/binaire
T_3_6=cbind(gener_binom(0.45), gener_binom(0.45))
C_3_6=cbind(gener_binom(0.45), gener_binom(0.45))
```


Pour les variables tte, une liste de 2 éléments sors, TT le temps et delta la censure
```{r}
extract_value_tte <- function(vecteur) {
nom_vecteur <- deparse(substitute(vecteur))
  
  if (grepl("[123]$", nom_vecteur)) {
    return(vecteur[c(1, 3)])
  } else {
    return(vecteur) 
  }
}
```


## GPC



```{r}
affect_value_GPC=function(vecteur1,vecteur2,w=1, threshold=0){
  cpt=c(0,0)
  
  nom_vecteur1 <- deparse(substitute(vecteur1))
  nom_vecteur2 <- deparse(substitute(vecteur2))
  if (grepl("[1]$" , nom_vecteur1) && grepl("[1]$" , nom_vecteur2)) { # tte/tte
    for(l in 1:2){
    for(i in 1:length(vecteur1[[l+1]])){
      for (j in 1:length(vecteur2[[l+1]])){
        if(vecteur1[[l+1]][[i]]==1 && vecteur2[[l+1]][[j]]==1){
          if(vecteur1[[l]][[i]]-vecteur2[[l]][j] > threshold){cpt[l]=cpt[l]+1}
          else if(abs(vecteur1[[l]][[i]]-vecteur2[[l]][j]) <= threshold){cpt[l]=cpt[l]}
          else if(vecteur1[[l]][[i]]-vecteur2[[l]][j] < - threshold){cpt[l]=cpt[l]-1}
        }
        if(vecteur1[[l+1]][[i]]==0 && vecteur2[[l+1]][[j]]==1){
          if(vecteur1[[l]][[i]]-vecteur2[[l]][j] > threshold){cpt[l]=cpt[l]+1}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[l]=cpt[l]}
          else if(vecteur1[[l]][[i]]-vecteur2[[l]][j] < - threshold){cpt[l]=cpt[l]}
        }
        if(vecteur1[[l+1]][[i]]==1 && vecteur2[[l+1]][[j]]==0){
          if(vecteur1[[l]][[i]]-vecteur2[[l]][j] > threshold){cpt[l]=cpt[l]}
          else if(abs(vecteur1[[l]][[i]]-vecteur2[[l]][j]) <= threshold){cpt[l]=cpt[l]}
          else if(vecteur1[[l]][[i]]-vecteur2[[l]][j] < - threshold){cpt[l]=cpt[l]-1}
        }
        if(vecteur1[[l+1]][[i]]==0 && vecteur2[[l+1]][[j]]==0){
          if(vecteur1[[l]][[i]]-vecteur2[[l]][j] > threshold){cpt[l]=cpt[l]}
          else if(abs(vecteur1[[l]][[i]]-vecteur2[[l]][j]) <= threshold){cpt[l]=cpt[l]}
          else if(vecteur1[[l]][[i]]-vecteur2[[l]][j] < - threshold){cpt[l]=cpt[l]}
        }
        
      }
    }
      print(cpt)
    }

  }
  
  if (grepl("[2]$", nom_vecteur1) && grepl("[2]$", nom_vecteur2)) { # tte/continue
    for(i in 1:length(vecteur1[[2]])){
      for (j in 1:length(vecteur2[[2]])){
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[j]]==1){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]+1}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]-1}
        }
        if(vecteur1[[2]][[i]]==0 && vecteur2[[2]][[j]]==1){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]+1}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]}
        }
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[j]]==0){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]-1}
        }
        if(vecteur1[[2]][[i]]==0 && vecteur2[[2]][[j]]==0){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]}
        }
        
      }
      }
    
    for(i in 1:length(vecteur1[[2]])){
      for (j in 1:length(vecteur2[[2]])){
        if(vecteur1[[2]][[i]] - vecteur2[[2]][[j]]> threshold){
         cpt[2] = cpt[2] + 1
        } else if (vecteur1[[2]][[i]] - vecteur2[[2]][[j]] < - threshold){
          cpt[2] = cpt[2] - 1
        }
        else if (abs(vecteur1[[2]][[i]]-vecteur2[[2]][[j]])<= threshold){cpt[2]=cpt[2]}
     }
    }
    print(cpt)
    

  }
    if (grepl("[3]$" , nom_vecteur1) && grepl("[3]$" , nom_vecteur2)) {# tte/binaire
      for(i in 1:length(vecteur1[[2]])){
      for (j in 1:length(vecteur2[[2]])){
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[j]]==1){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]+1}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]-1}
        }
        if(vecteur1[[2]][[i]]==0 && vecteur2[[2]][[j]]==1){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]+1}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]}
        }
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[j]]==0){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]-1}
        }
        if(vecteur1[[2]][[i]]==0 && vecteur2[[2]][[j]]==0){
          if(vecteur1[[1]][[i]]-vecteur2[[1]][j] > threshold){cpt[1]=cpt[1]}
          else if(abs(vecteur1[[1]][[i]]-vecteur2[[1]][j]) <= threshold){cpt[1]=cpt[1]}
          else if(vecteur1[[1]][[i]]-vecteur2[[1]][j] < - threshold){cpt[1]=cpt[1]}
        }
        
      }
      }
      for(i in 1:length(vecteur1[[2]])){
      for (j in 1:length(vecteur2[[2]])){
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[i]]==0){
         cpt[2] = cpt[2] + 1
        } else if (vecteur1[[2]][[i]]==0 && vecteur2[[2]][[i]]==1){
          cpt[2] = cpt[2] - 1
        }
        else {cpt[2]=cpt[2]}
     }
    }
      print(cpt)

  }
  
  if (grepl("[4]$", nom_vecteur1) && grepl("[4]$", nom_vecteur2)) { # continue / continue
    for(l in 1:2){
    for(i in 1:length(vecteur1[[l]])){
      for (j in 1:length(vecteur2[[l]])){
        if(vecteur1[[l]][[i]] - vecteur2[[l]][[j]]> threshold){
         cpt[l] = cpt[l] + 1
        } else if (vecteur1[[l]][[i]] - vecteur2[[l]][[j]] < - threshold){
          cpt[l] = cpt[l] - 1
        }
        else if (abs(vecteur1[[l]][[i]]-vecteur2[[l]][[j]])<= threshold){cpt[l]=cpt[l]}
     }
    }
    print(cpt[l])
  }

  }
    if (grepl("[5]$" , nom_vecteur1) && grepl("[5]$" , nom_vecteur2)) { # continue / binaire
    for(i in 1:length(vecteur1[[1]])){
      for (j in 1:length(vecteur2[[1]])){
        if(vecteur1[[1]][[i]] - vecteur2[[1]][[j]]> threshold){
         cpt[1] = cpt[1] + 1
        } else if (vecteur1[[1]][[i]] - vecteur2[[1]][[j]] < - threshold){
          cpt[1] = cpt[1] - 1
        }
        else if (abs(vecteur1[[1]][[i]]-vecteur2[[1]][[j]])<= threshold){cpt[1]=cpt[1]}
     }
    }
      for(i in 1:length(vecteur1[[2]])){
      for (j in 1:length(vecteur2[[2]])){
        if(vecteur1[[2]][[i]]==1 && vecteur2[[2]][[i]]==0){
         cpt[2] = cpt[2] + 1
        } else if (vecteur1[[2]][[i]]==0 && vecteur2[[2]][[i]]==1){
          cpt[2] = cpt[2] - 1
        }
        else {cpt[2]=cpt[2]}
     }
    }
    print(cpt)
  }

  
  if (grepl("[6]$", nom_vecteur1) && grepl("[6]$", nom_vecteur2)) { # binaire / binaire
    for(l in 1:2){
    for(i in 1:length(vecteur1[[l]])){
      for (j in 1:length(vecteur2[[l]])){
        if(vecteur1[[l]][[i]]==1 && vecteur2[[l]][[i]]==0){
         cpt[l] = cpt[l] + 1
        } else if (vecteur1[[l]][[i]]==0 && vecteur2[[l]][[i]]==1){
          cpt[l] = cpt[l] - 1
        }
        else {cpt[l]=cpt[l]}
     }
    }
    print(cpt[l])
  }

  }
  
  return((cpt[1]+w*cpt[2])/(n*n))
}
affect_value_GPC(T_2_4,C_2_4)
```
## Win ratio 

```{r}

```


